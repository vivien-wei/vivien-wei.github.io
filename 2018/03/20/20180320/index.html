<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>H5 解决ios拍照旋转90度 | Hexo</title>

  
  <meta name="author" content="vivien">
  

  
  <meta name="description" content="注：在您的HTML中添加一个脚本标记，以最佳位置引用本地文件exif.js。


html12&amp;lt;input type=&amp;quot;file&amp;quot; accept=&amp;quot;image/*&amp;quot; id=&amp;quot;uploadImage&amp;quot;  onchange=&amp;quot;selectFileImage(this);&amp;quot; /&amp;gt;&amp;lt;img src=&amp;quot;&amp;quot; id=&amp;quot;myImage&amp;quot;/&amp;gt;">
  

  
  
  <meta name="keywords" content="前端">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="H5 解决ios拍照旋转90度"/>

  <meta property="og:site_name" content="Hexo"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">Hexo</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>H5 解决ios拍照旋转90度</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/03/20/20180320/" rel="bookmark">
        <time class="entry-date published" datetime="2018-03-20T01:53:45.236Z">
          2018-03-20
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>注：在您的HTML中添加一个脚本标记，以最佳位置引用本地文件exif.js。</p>
<script src="js/exif.js"></script>

<h3 id="html"><a href="#html" class="headerlink" title="html"></a>html</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;file&quot; accept=&quot;image/*&quot; id=&quot;uploadImage&quot;  onchange=&quot;selectFileImage(this);&quot; /&gt;</span><br><span class="line">&lt;img src=&quot;&quot; id=&quot;myImage&quot;/&gt;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="js"><a href="#js" class="headerlink" title="js"></a>js</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line">var img_photo=&apos;&apos;;</span><br><span class="line">function selectFileImage(fileObj) &#123;</span><br><span class="line">	var formdata = new FormData();</span><br><span class="line">	var file = fileObj.files[&apos;0&apos;];</span><br><span class="line">	var Orientation = null;</span><br><span class="line">	if (file) &#123;</span><br><span class="line">	    console.log(&quot;正在上传,请稍后...&quot;);</span><br><span class="line">	    var rFilter = /^(image\/jpeg|image\/png)$/i; // 检查图片格式</span><br><span class="line">	    if (!rFilter.test(file.type)) &#123;</span><br><span class="line">	        //showMyTips(&quot;请选择jpeg、png格式的图片&quot;, false);</span><br><span class="line">	        return;</span><br><span class="line">	    &#125;</span><br><span class="line">	    // var URL = URL || webkitURL;</span><br><span class="line">	    //获取照片方向角属性，用户旋转控制</span><br><span class="line">	    EXIF.getData(file, function() &#123;</span><br><span class="line">	        // alert(EXIF.pretty(this));</span><br><span class="line">	        EXIF.getAllTags(this);</span><br><span class="line">	        //alert(EXIF.getTag(this, &apos;Orientation&apos;));</span><br><span class="line">	        Orientation = EXIF.getTag(this, &apos;Orientation&apos;);</span><br><span class="line">	        //return;</span><br><span class="line">	    &#125;);</span><br><span class="line"></span><br><span class="line">        var oReader = new FileReader();</span><br><span class="line">        oReader.onload = function(e) &#123;</span><br><span class="line">            //var blob = URL.createObjectURL(file);</span><br><span class="line">            //_compress(blob, file, basePath);</span><br><span class="line">            var image = new Image();</span><br><span class="line">            image.crossOrigin = &apos;Anonymous&apos;; //解决跨域</span><br><span class="line">            image.src = e.target.result;</span><br><span class="line">            image.onload = function() &#123;</span><br><span class="line">                var expectWidth = this.naturalWidth;</span><br><span class="line">                var expectHeight = this.naturalHeight;</span><br><span class="line">                if (this.naturalWidth &gt; this.naturalHeight &amp;&amp; this.naturalWidth &gt; 800) &#123;</span><br><span class="line">                    expectWidth = 800;</span><br><span class="line">                    expectHeight = expectWidth * this.naturalHeight / this.naturalWidth;</span><br><span class="line">                &#125; else if (this.naturalHeight &gt; this.naturalWidth &amp;&amp; this.naturalHeight &gt; 1200) &#123;</span><br><span class="line">                    expectHeight = 1200;</span><br><span class="line">                    expectWidth = expectHeight * this.naturalWidth / this.naturalHeight;</span><br><span class="line">                &#125;</span><br><span class="line">                var canvas = document.createElement(&quot;canvas&quot;);</span><br><span class="line">                var context = canvas.getContext(&quot;2d&quot;);</span><br><span class="line">                var base63 = null;</span><br><span class="line">                //修复ios</span><br><span class="line">                if (navigator.userAgent.match(/iphone/i)) &#123;</span><br><span class="line">                    console.log(&apos;iphone&apos;);</span><br><span class="line">                    //alert(expectWidth + &apos;,&apos; + expectHeight);</span><br><span class="line">                    //如果方向角不为1，都需要进行旋转 added by lzk</span><br><span class="line">                    if(Orientation != &quot;&quot; &amp;&amp; Orientation != 1)&#123;</span><br><span class="line">                        //alert(&apos;旋转处理&apos;);</span><br><span class="line">                        switch(Orientation)&#123;</span><br><span class="line">                            case 6://需要顺时针（向左）90度旋转</span><br><span class="line">                                rotateImg(this,&apos;left&apos;,canvas);</span><br><span class="line">                                    break;</span><br><span class="line">                            case 8://需要逆时针（向右）90度旋转</span><br><span class="line">                                rotateImg(this,&apos;right&apos;,canvas);</span><br><span class="line">                                break;</span><br><span class="line">                            case 3://需要180度旋转</span><br><span class="line">                                rotateImg(this,&apos;right&apos;,canvas);//转两次</span><br><span class="line">                                rotateImg(this,&apos;right&apos;,canvas);</span><br><span class="line">                                break;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        base63 = canvas.toDataURL(&quot;image/jpeg&quot;, 0.8);</span><br><span class="line">                    &#125;else&#123;</span><br><span class="line">                        //alert(Orientation);</span><br><span class="line">                        if(Orientation != &quot;&quot; &amp;&amp; Orientation != 1)&#123;</span><br><span class="line">                            //alert(&apos;旋转处理&apos;);</span><br><span class="line">                            switch(Orientation)&#123;</span><br><span class="line">                                case 6://需要顺时针（向左）90度旋转</span><br><span class="line">                                    rotateImg(this,&apos;left&apos;,canvas);</span><br><span class="line">                                    break;</span><br><span class="line">                                case 8://需要逆时针（向右）90度旋转</span><br><span class="line">                                    rotateImg(this,&apos;right&apos;,canvas);</span><br><span class="line">                                    break;</span><br><span class="line">                                case 3://需要180度旋转</span><br><span class="line">                                    rotateImg(this,&apos;right&apos;,canvas);//转两次</span><br><span class="line">                                    rotateImg(this,&apos;right&apos;,canvas);</span><br><span class="line">                                    break;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        base63 = canvas.toDataURL(&quot;image/jpeg&quot;, 0.8);</span><br><span class="line">                    &#125;</span><br><span class="line">                    //uploadImage(base64);</span><br><span class="line">                     img_photo=base63;</span><br><span class="line">                   //哪里需要用到上传的图片就放到对应的src下</span><br><span class="line">                    $(&quot;myImage&quot;).attr(&quot;src&quot;, img_photo);</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">            oReader.readAsDataURL(file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //对图片旋转处理 added by lzk</span><br><span class="line">    function rotateImg(img, direction,canvas) &#123;</span><br><span class="line">        //alert(img);</span><br><span class="line">        //最小与最大旋转方向，图片旋转4次后回到原方向</span><br><span class="line">        var min_step = 0;</span><br><span class="line">        var max_step = 3;</span><br><span class="line">        //var img = document.getElementById(pid);</span><br><span class="line">        if (img == null)return;</span><br><span class="line">        //img的高度和宽度不能在img元素隐藏后获取，否则会出错</span><br><span class="line">        var height = img.height;</span><br><span class="line">        var width = img.width;</span><br><span class="line">        //var step = img.getAttribute(&apos;step&apos;);</span><br><span class="line">        var step = 2;</span><br><span class="line">        if (step == null) &#123;</span><br><span class="line">            step = min_step;</span><br><span class="line">        &#125;</span><br><span class="line">        if (direction == &apos;right&apos;) &#123;</span><br><span class="line">            step++;</span><br><span class="line">            //旋转到原位置，即超过最大值</span><br><span class="line">            step &gt; max_step &amp;&amp; (step = min_step);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            step--;</span><br><span class="line">            step &lt; min_step &amp;&amp; (step = max_step);</span><br><span class="line">        &#125;</span><br><span class="line">        //img.setAttribute(&apos;step&apos;, step);</span><br><span class="line">        /*var canvas = document.getElementById(&apos;pic_&apos; + pid);</span><br><span class="line">         if (canvas == null) &#123;</span><br><span class="line">         img.style.display = &apos;none&apos;;</span><br><span class="line">         canvas = document.createElement(&apos;canvas&apos;);</span><br><span class="line">         canvas.setAttribute(&apos;id&apos;, &apos;pic_&apos; + pid);</span><br><span class="line">         img.parentNode.appendChild(canvas);</span><br><span class="line">         &#125;  */</span><br><span class="line">        //旋转角度以弧度值为参数</span><br><span class="line">        var degree = step * 90 * Math.PI / 180;</span><br><span class="line">        var context = canvas.getContext(&apos;2d&apos;);</span><br><span class="line">        switch (step) &#123;</span><br><span class="line">            case 0:</span><br><span class="line">                canvas.width = width;</span><br><span class="line">                canvas.height = height;</span><br><span class="line">                context.drawImage(img, 0, 0);</span><br><span class="line">                break;</span><br><span class="line">            case 1:</span><br><span class="line">                canvas.width = height;</span><br><span class="line">                canvas.height = width;</span><br><span class="line">                context.rotate(degree);</span><br><span class="line">                context.drawImage(img, 0, -height);</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                canvas.width = width;</span><br><span class="line">                canvas.height = height;</span><br><span class="line">                context.rotate(degree);</span><br><span class="line">                context.drawImage(img, -width, -height);</span><br><span class="line">                break;</span><br><span class="line">            case 3:</span><br><span class="line">                canvas.width = height;</span><br><span class="line">                canvas.height = width;</span><br><span class="line">                context.rotate(degree);</span><br><span class="line">                context.drawImage(img, -width, 0);</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/javascript/">javascript</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/前端/">前端</a>
    </span>
    

    </div>

    
  </div>
</article>


    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2018 vivien
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>